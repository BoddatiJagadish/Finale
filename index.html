<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Food Cropping Game</title>
  <style>
    :root {
      --bg: #e8f5e9;
      --panel: #ffffffcc;
      --accent: #2e7d32;
      --muted: #6b6b6b;
    }
    body {
      margin: 0;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg,#f1fbf4 0%, #e8f5e9 100%);
      color: #123;
      display:flex;
      gap:16px;
      padding: 18px;
      align-items:flex-start;
      min-height:100vh;
      box-sizing:border-box;
    }
    .game {
      background: var(--panel);
      border-radius:12px;
      box-shadow:0 8px 20px rgba(30,60,0,0.08);
      padding:12px;
      width:720px;
    }
    canvas {
      background: linear-gradient(#c9f7d6, #a8e6b9);
      border-radius:8px;
      display:block;
      width:100%;
      height:480px;
      touch-action: none;
    }
    .sidebar {
      width:320px;
      background:var(--panel);
      border-radius:12px;
      padding:12px;
      box-shadow:0 8px 20px rgba(0,0,0,0.05);
      height:520px;
      box-sizing:border-box;
    }
    h1 { font-size:20px; margin:6px 0 12px; color:var(--accent); }
    .controls { display:flex; gap:8px; margin-bottom:10px; flex-wrap:wrap; }
    button {
      background:var(--accent);
      color:white;
      border:0;
      padding:8px 12px;
      border-radius:8px;
      cursor:pointer;
      font-weight:600;
    }
    button.secondary { background:transparent; border:1px solid #cfe8d6; color:var(--accent); }
    .info { font-size:13px; color:var(--muted); margin-top:10px; }
    .row { display:flex; gap:10px; align-items:center; justify-content:space-between; margin-bottom:8px; }
    .stat { font-weight:700; color:#0b4d22; }
    .log { height:160px; overflow:auto; background:#fff; border-radius:8px; padding:8px; border:1px dashed #e0efe0; font-size:13px; color:#123; }
    .legend { display:flex; gap:10px; margin-top:8px; flex-wrap:wrap; }
    .badge { background:#f0fff4; padding:6px 8px; border-radius:6px; border:1px solid #dff2df; font-size:13px; color:#086b2f; }
    small { color:var(--muted); }
  </style>
</head>
<body>

  <div class="game">
    <h1>Food Cropping — Plant, Water, Harvest</h1>
    <div class="controls">
      <button id="seedBtn">Plant Seed (Cost 0)</button>
      <button id="waterBtn" class="secondary">Water</button>
      <button id="pesticideBtn" class="secondary">Pesticide</button>
      <button id="sellBtn">Sell Harvest</button>
      <div style="flex:1"></div>
      <div style="align-self:center"><small>Click on soil to plant / harvest.</small></div>
    </div>
    <canvas id="field" width="700" height="480"></canvas>
  </div>

  <div class="sidebar">
    <div class="row">
      <div>
        <div style="font-size:14px;color:var(--muted)">Money</div>
        <div class="stat" id="money">$0</div>
      </div>
      <div>
        <div style="font-size:14px;color:var(--muted)">Points</div>
        <div class="stat" id="points">0</div>
      </div>
    </div>

    <div class="row">
      <div style="width:48%">
        <div style="font-size:12px;color:var(--muted)">Seeds</div>
        <div id="seeds">∞</div>
      </div>
      <div style="width:48%">
        <div style="font-size:12px;color:var(--muted)">Plants</div>
        <div id="plantCount">0</div>
      </div>
    </div>

    <div class="legend">
      <div class="badge">Plant stages: seed → sprout → growing → mature</div>
      <div class="badge">Water to speed growth</div>
    </div>

    <h3 style="margin-top:12px;font-size:16px;color:#0b6623">Log</h3>
    <div class="log" id="log"></div>

    <div class="info">
      <p><strong>How to play</strong></p>
      <ol>
        <li>Click any empty soil cell on the field to plant a seed.</li>
        <li>Use <em>Water</em> to speed growth (click button then click a plant).</li>
        <li>Use <em>Pesticide</em> to remove pests from a plant (costs money).</li>
        <li>Harvest mature plants by clicking them; then sell for money & points.</li>
      </ol>
    </div>
  </div>

<script>
/*
  Simple Food Cropping Game
  - grid-based field
  - plant seeds by clicking empty cell
  - each plant has growth stages and timers
  - water reduces time-to-next-stage
  - pests can appear and reduce growth/health
  - harvest when mature -> get money & points
*/

const canvas = document.getElementById('field');
const ctx = canvas.getContext('2d');
const logEl = document.getElementById('log');

const moneyEl = document.getElementById('money');
const pointsEl = document.getElementById('points');
const plantCountEl = document.getElementById('plantCount');

const seedBtn = document.getElementById('seedBtn');
const waterBtn = document.getElementById('waterBtn');
const pesticideBtn = document.getElementById('pesticideBtn');
const sellBtn = document.getElementById('sellBtn');

let money = 0;
let points = 0;
let selectedTool = 'plant'; // 'plant', 'water', 'pesticide'
let gridCols = 7, gridRows = 5;
let cellW = canvas.width / gridCols;
let cellH = canvas.height / gridRows;

let plants = []; // store plant objects keyed by r,c via index r*cols+c

function initPlants() {
  plants = new Array(gridRows * gridCols).fill(null);
}
initPlants();

function log(msg) {
  const t = new Date().toLocaleTimeString();
  logEl.innerHTML = `<div>[${t}] ${msg}</div>` + logEl.innerHTML;
}

// Plant model
function createPlant() {
  return {
    stage: 0, // 0 seed, 1 sprout, 2 growing, 3 mature
    age: 0, // seconds since planted
    growthForNext: 8 + Math.random()*10, // seconds to next stage
    watered: 0, // times watered (reduces next time)
    pest: false,
    health: 100
  };
}

// Tools
seedBtn.addEventListener('click', ()=> { selectedTool = 'plant'; seedBtn.style.opacity=1; waterBtn.style.opacity=0.9; pesticideBtn.style.opacity=0.9; });
waterBtn.addEventListener('click', ()=> { selectedTool = 'water'; seedBtn.style.opacity=0.9; waterBtn.style.opacity=1; pesticideBtn.style.opacity=0.9; });
pesticideBtn.addEventListener('click', ()=> { selectedTool = 'pesticide'; seedBtn.style.opacity=0.9; waterBtn.style.opacity=0.9; pesticideBtn.style.opacity=1; });
sellBtn.addEventListener('click', ()=> {
  // Sell all harvested produce (money already given on harvest; this is bonus)
  const bonus = Math.floor(points * 0.1);
  money += bonus;
  log(`Sold bonus produce for $${bonus}`);
  updateHUD();
});

canvas.addEventListener('click', (e)=>{
  const rect = canvas.getBoundingClientRect();
  const x = (e.clientX - rect.left) * (canvas.width/rect.width);
  const y = (e.clientY - rect.top) * (canvas.height/rect.height);
  const c = Math.floor(x / cellW);
  const r = Math.floor(y
